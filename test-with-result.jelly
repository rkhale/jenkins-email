<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:d="jelly:define">
<html>
  <head>
      <title>${project.name}</title>
      <style>
          body table, td, th, p, h1, h2 {
          margin:0;
          font:normal normal 100% Georgia, Serif;
          background-color: #ffffff;
          }
          h1, h2 {
          border-bottom:dotted 1px #999999;
          padding:5px;
          margin-top:10px;
          margin-bottom:10px;
          color: #000000;
          font: normal bold 130% Georgia,Serif;
          background-color:#f0f0f0;
          }
          tr.gray {
          background-color:#f0f0f0;
          }
          h2 {
          padding:5px;
          margin-top:5px;
          margin-bottom:5px;
          font: italic bold 110% Georgia,Serif;
          }
          .bg2 {
          color:black;
          background-color:#E0E0E0;
          font-size:110%
          }
          th {
          font-weight: bold;
	  background-color:#ffffcc;
          }
          tr, td, th {
          padding:2px;
          }
          td.test_passed {
          color:green;
	  text-align:center;
          }
          td.test_failed {
          color:red;
	  text-align:center;
          }
          td.test_skipped {
          color:grey;
	  text-align:center;
          }
          td.test_total {
          color:blue;
	  font-weight: bold;
	  text-align:center;
          }
	  td.test_failed_details {
          color:red;
	  text-align:left;
	  margin: 1px;
          padding: 1px;
          }
	  td.test_final {
          color:black;
	  text-align:center;
	  font-weight: bold;
	  margin: 2px;
          padding: 2px;
          }	  
          .console {
          font: normal normal 90% Courier New, monotype;
          padding:0px;
          margin:0px;
          }
          div.content, div.header {
          background: #ffffff;
          border: dotted 1px #666;
          margin: 2px;
          content: 2px;
          padding: 2px;
          }
          table.border, th.border, td.border {
          border: 1px solid black;
          border-collapse:collapse;
          }
          td.right {
          text-align:right;
          }
	  ul {
	  list-style-type:disc;
  	  margin: 2.5px;
	  padding-left:17px;
	  }
	  bold {
	  text-align:right;
	  font-weight:bold;
	  }
      </style>
  </head>
  <body>
    <div class="header">
      <j:set var="spc" value="&amp;nbsp;&amp;nbsp;" />
      <!-- GENERAL INFO -->
      <table>
        <tr class="gray">
          <td align="right">
            <j:choose>
              <j:when test="${build.result=='SUCCESS'}">
                <img src="${rooturl}static/e59dfe28/images/32x32/blue.gif" />
              </j:when>
              <j:when test="${build.result=='FAILURE'}">
                <img src="${rooturl}static/e59dfe28/images/32x32/red.gif" />
              </j:when>
              <j:otherwise>
                <img src="${rooturl}static/e59dfe28/images/32x32/yellow.gif" />
              </j:otherwise>
            </j:choose>
          </td>
          <td valign="center">
            <b style="font-size: 200%;">${project.name} BUILD #${build.number} ${build.result}</b>
          </td>
        </tr>
	<tr>
          <td><strong>Project:</strong></td>
          <td>
	     <a href="${rooturl}${project.url}">${project.name}</a>
	  </td>
        </tr>
        <tr>
          <td><strong>Build:</strong></td>
          <td>
            <a href="${rooturl}${build.url}">${project.name} - ${build.number}</a>
          </td>
        </tr>	
	<tr>
          <td><strong>Test Results:</strong></td>
          <td>
	     <a href="${rooturl}${build.url}testReport">${project.name} - ${build.number} - TestReport</a>
	  </td>
        </tr>
	<tr>
		<td><strong>SEP Build:</strong></td>
        	<td><strong>${build.DisplayName}</strong></td>
	</tr>        
        <tr>
          <td><strong>Date of build:</strong></td>
          <td>${it.timestampString}</td>
        </tr>
        <tr>
          <td><strong>Build duration:</strong></td>
          <td>${build.durationString}</td>
        </tr>
        <tr>
          <td><strong>Build cause:</strong></td>
          <td>
            <j:forEach var="cause" items="${build.causes}">${cause.shortDescription} </j:forEach>
          </td>
        </tr>
        <tr>
          <td><strong>Built on:</strong></td>
          <td>
            <j:choose>
              <j:when test="${build.builtOnStr!=''}">${build.builtOnStr}</j:when>
              <j:otherwise>master</j:otherwise>
            </j:choose>
          </td>
        </tr>
      </table>
    </div>

    <!-- HEALTH TEMPLATE -->
    <div class="content">
      <j:set var="healthIconSize" value="16x16" />
      <j:set var="healthReports" value="${project.buildHealthReports}" />
      <j:if test="${healthReports!=null}">
        <h1>Health Report</h1>
        <table>
          <tr>
            <th>W</th>
            <th>Description</th>
            <th>Score</th>
          </tr>
          <j:forEach var="healthReport" items="${healthReports}">
            <tr>
              <td>
                <img src="${rooturl}${healthReport.getIconUrl(healthIconSize)}" />
              </td>
              <td>${healthReport.description}</td>
              <td>${healthReport.score}</td>
            </tr>
          </j:forEach>
        </table>
        <br />
      </j:if>
    </div>

    <!-- ARTIFACTS -->
    <j:set var="artifacts" value="${build.artifacts}" />
    <j:if test="${artifacts!=null and artifacts.size()&gt;0}">
      <div class="content">
        <h1>Build Artifacts</h1>
        <ul>
          <j:forEach var="f" items="${artifacts}">
            <li>
              <a href="${rooturl}${build.url}artifact/${f}">${f}</a>
            </li>
          </j:forEach>
        </ul>
      </div>
    </j:if>

    <!-- JUnit TEMPLATE -->
    <j:set var="junitResultList" value="${it.JUnitTestResult}" />
    <j:if test="${junitResultList.isEmpty()!=true}">
      <div class="content">
        <a href="${rooturl}${build.url}/testReport">
          <h1 title="Click this link for Test Report">JUnit Tests</h1>
        </a>
	<!--<img src="${rooturl}${project.url}test/trend" height="200" width="550" align="middle"/>-->
	<img src="${rooturl}${project.url}test/trend" height="200" width="550" align="middle"/>
        <table class="border">
          <tr>
            <th class="border">Operating System</th>            
            <th class="border">Passed</th>
   	    <th class="border">Failed</th>
            <th class="border">Skipped</th>
            <th class="border">Total</th>
          </tr>
          <j:forEach var="junitResult" items="${it.JUnitTestResult}">
            <j:forEach var="packageResult" items="${junitResult.getChildren()}">
              <tr>
                <td class="border">
                  <strong>${packageResult.getName()}</strong>
                </td>
                <td class="border test_passed" style="text-align:center;color:green">${packageResult.getPassCount()}</td>
                <td class="border test_failed" style="text-align:center;color:red">${packageResult.getFailCount()}</td>
                <td class="border test_skipped" style="text-align:center;color:gray">${packageResult.getSkipCount()}</td>
                <td class="border test_total" style="text-align:center;color:blue">${packageResult.getPassCount()+packageResult.getFailCount()+packageResult.getSkipCount()}</td>
              </tr>
              <j:forEach var="failed_test" items="${packageResult.getFailedTests()}">
                <tr>
                  <td class="test_failed_details" colspan="5">                    
		  	<ul>                
				<li><tt><a href="${rooturl}${build.url}testReport/junit/${packageResult.getName()}/">${failed_test.getFullName()}</a></tt></li>
		    	</ul>
                  </td>
                </tr>
              </j:forEach>
            </j:forEach>
          </j:forEach>
	 <tr>
	 <td class="border test_final"><strong>TOTAL</strong></td>
	 <td class="border test_final" style="text-align:center;color:green"><strong>${junitResult.getPassCount()}</strong></td>
	 <td class="border test_final" style="text-align:center;color:red"><strong>${junitResult.getFailCount()}</strong></td>
	 <td class="border test_final" style="text-align:center;color:gray"><strong>${junitResult.getSkipCount()}</strong></td>
	 <td class="border test_final" style="text-align:center;color:blue"><strong>${junitResult.getPassCount()+junitResult.getFailCount()+junitResult.getSkipCount()}</strong></td>
	 </tr>
        </table>
        <br />
      </div>
    </j:if>

    <!-- COBERTURA TEMPLATE -->
    <j:set var="coberturaAction" value="${it.coberturaAction}" />
    <j:if test="${coberturaAction!=null}">
      <div class="content">
        <j:set var="coberturaResult" value="${coberturaAction.result}" />
        <j:if test="${coberturaResult!=null}">
          <a href="${rooturl}${build.url}/cobertura">
            <h1>Cobertura Report</h1>
          </a>
          <h2>Project Coverage Summary</h2>
          <table class="border">
            <tr>
              <th class="border">Name</th>
              <j:forEach var="metric" items="${coberturaResult.metrics}">
                <th class="border">${metric.name}</th>
              </j:forEach>
            </tr>
            <tr>
              <td class="border">${coberturaResult.name}</td>
              <j:forEach var="metric" items="${coberturaResult.metrics}">
                <td class="border" data="${coberturaResult.getCoverage(metric).percentageFloat}">${coberturaResult.getCoverage(metric).percentage}%
                  (${coberturaResult.getCoverage(metric)})
                        </td>
              </j:forEach>
            </tr>
          </table>
          <j:if test="${coberturaResult.sourceCodeLevel}">
            <h2>Source</h2>
            <j:choose>
              <j:when test="${coberturaResult.sourceFileAvailable}">
                <div style="overflow-x:scroll;">
                  <table class="source">
                    <thead>
                      <tr>
                        <th colspan="3">${coberturaResult.relativeSourcePath}</th>
                      </tr>
                    </thead>
                    ${coberturaResult.sourceFileContent}
                  </table>
                </div>
              </j:when>
              <j:otherwise>
                <p>
                  <i>Source code is unavailable</i>
                </p>
              </j:otherwise>
            </j:choose>
          </j:if>
          <j:forEach var="element" items="${coberturaResult.childElements}">
            <j:set var="childMetrics" value="${coberturaResult.getChildMetrics(element)}" />
            <h2>Coverage Breakdown by ${element.displayName}</h2>
            <table class="border">
              <tr>
                <th class="border">Name</th>
                <j:forEach var="metric" items="${childMetrics}">
                  <th class="border">${metric.name}</th>
                </j:forEach>
              </tr>
              <j:forEach var="c" items="${coberturaResult.children}">
                <j:set var="child" value="${coberturaResult.getChild(c)}" />
                <tr>
                  <td class="border">
                    ${child.xmlTransform(child.name)}
                            </td>
                  <j:forEach var="metric" items="${childMetrics}">
                    <j:set var="childResult" value="${child.getCoverage(metric)}" />
                    <j:choose>
                      <j:when test="${childResult!=null}">
                        <td class="border" data="${childResult.percentageFloat}">${childResult.percentage}%
                          (${childResult})
                                        </td>
                      </j:when>
                      <j:otherwise>
                        <td class="border" data="101">N/A</td>
                      </j:otherwise>
                    </j:choose>
                  </j:forEach>
                </tr>
              </j:forEach>
            </table>
          </j:forEach>
        </j:if>
        <br />
      </div>
    </j:if>
    
    <!-- JACOCO TEMPLATE -->
    <j:set var="jacocoAction" value="${it.getAction('hudson.plugins.jacoco.JacocoBuildAction')}" />
    <j:if test="${jacocoAction!=null}">
        <j:set var="jacocoResult" value="${jacocoAction.result}" />
        <j:if test="${jacocoResult!=null}">
            <a href="${rooturl}${build.url}jacoco/">
                <h1>Jacoco Results</h1>
            </a>
            <table class="border">
                <tr>
                    <th class="border">Package</th>
                    <th class="border">Branches</th>
                    <th class="border">Complexity</th>
                    <th class="border">Instructions</th>
                    <th class="border">Methods</th>
                    <th class="border">Lines</th>
                    <th class="border">Classes</th>
                </tr>
                <j:forEach var="child" items="${jacocoResult.getChildren().entrySet()}">
                    <j:set var="cResult" value="${child.value}"/>
                    <tr>
                        <td class="border">
                            <a href="${rooturl}${build.url}jacoco/${child.key}/"><tt>${child.key}</tt></a>
                        </td>
                        <td class="border right">${cResult.branchCoverage.percentage}%</td>
                        <td class="border right">${cResult.complexityScore.percentage}%</td>
                        <td class="border right">${cResult.instructionCoverage.percentage}%</td>
                        <td class="border right">${cResult.methodCoverage.percentage}%</td>
                        <td class="border right">${cResult.lineCoverage.percentage}%</td>
                        <td class="border right">${cResult.classCoverage.percentage}%</td>
                    </tr>
                </j:forEach>
                <tr>
                    <td class="border">
                        <a href="${rooturl}${build.url}jacoco/"><tt>OVERALL</tt></a>
                    </td>
                    <td class="border right">${jacocoResult.branchCoverage.percentage}%</td>
                    <td class="border right">${jacocoResult.complexityScore.percentage}%</td>
                    <td class="border right">${jacocoResult.instructionCoverage.percentage}%</td>
                    <td class="border right">${jacocoResult.methodCoverage.percentage}%</td>
                    <td class="border right">${jacocoResult.lineCoverage.percentage}%</td>
                    <td class="border right">${jacocoResult.classCoverage.percentage}%</td>
                </tr>
            </table>
        </j:if>
    </j:if>

    <div class="content">
      <!-- CONSOLE OUTPUT -->
      <a href="${rooturl}${build.url}consoleFull">
        <h1>Console Output</h1>
      </a>
      <table class="console" bordercolor='gray' bgcolor='#FAEBD7' cellpadding='5' cellspacing='0'>
        <j:forEach var="line" items="${build.getLog(25)}">
        <tr>
            <td><tt>${line}</tt></td>
        </tr>
        </j:forEach>
      </table>
      <br />
    </div>
<div class="content" style="text-align:right">
<!-- bottom message -->
<span style="color:gray:font-size:x-small">Please do not reply to this mail as the Mailbox is not monitored.<br></br>You are receving this email because you are a member of DL-ENG-SEP-LinuxAutomation.<br></br>If you no longer wish to revice this email, please request the dl owner to remove you from the dl.<br></br>Designed by Rohan Khale.</span>
</div>
  </body>
</html>
</j:jelly>
